[
	{
		"name": "UpdateBehavior",
		"type": "enum",
		"tag": "u8",
		"values": ["event", "reload"]
	},
	{
		"name": "EditPermission",
		"type": "enum",
		"tag": "u8",
		"values": ["private", "protected", "public"]
	},
	{
		"name": "Param",
		"type": "struct",
		"fields": [
			{
				"name": "type",
				"type": "string",
				"setter": false
			},
			{ "name": "id", "type": "string", "setter": false },
			{ "name": "name", "type": "string", "setter": false },
			{ "name": "desc", "type": "string", "setter": false },
			{
				"name": "doc",
				"type": "string",
				"optional": true,
				"setter": false,
				"default": { "zig": "null" }
			},
			{
				"name": "update",
				"type": "UpdateBehavior",
				"setter": false,
				"default": { "zig": ".event" }
			},
			{
				"name": "edit",
				"type": "EditPermission",
				"setter": false,
				"default": { "zig": ".protected" }
			},
			{
				"name": "randomize",
				"type": "u8",
				"setter": false,
				"default": 1
			},
			{ "name": "body", "type": "ParamBody", "setter": false }
		],
		"body": {
			"ts": {
				"decl": "asParam(): ParamOpts;",
				"impl": [
					"asParam(): ParamOpts {",
					"return {",
					"name: this.name.deref(),",
					"desc: this.desc.deref(),",
					"doc: this.doc.deref() || undefined,",
					"update: <any>UpdateBehavior[this.update],",
					"edit: <any>EditPermission[this.edit],",
					"randomize: !!this.randomize",
					"};",
					"}"
				]
			}
		}
	},
	{
		"name": "ParamBody",
		"type": "union",
		"fields": [
			{ "name": "choice", "type": "ChoiceParam", "setter": false },
			{ "name": "color", "type": "ColorParam", "setter": false },
			{ "name": "range", "type": "RangeParam", "setter": false },
			{ "name": "text", "type": "TextParam", "setter": false }
		]
	},
	{
		"name": "ChoiceParam",
		"type": "struct",
		"fields": [
			{
				"name": "default",
				"type": "string",
				"optional": true,
				"setter": false,
				"default": { "zig": "null" }
			},
			{
				"name": "options",
				"type": "Option",
				"tag": "slice",
				"doc": "In Zig, use `genart.options()` to wrap",
				"const": true,
				"setter": false
			}
		],
		"body": {
			"ts": {
				"decl": "asParam(parent: Param): ReturnType<typeof $genart.params.choice>;",
				"impl": [
					"asParam(parent: Param) {",
					"return $genart.params.choice<string>({",
					"...parent.asParam(),",
					"default: this.default.deref() || undefined,",
					"options: this.options.map((x) => x.label.addr ? [x.value.deref(), x.label.deref()]: x.value.deref()),",
					"});",
					"}"
				]
			}
		}
	},
	{
		"name": "Option",
		"type": "struct",
		"fields": [
			{ "name": "value", "type": "string" },
			{
				"name": "label",
				"type": "string",
				"optional": true,
				"default": { "zig": "null" }
			}
		]
	},
	{
		"name": "ColorParam",
		"type": "struct",
		"fields": [
			{
				"name": "default",
				"type": "string",
				"optional": true,
				"setter": false,
				"default": { "zig": "null" }
			}
		],
		"body": {
			"ts": {
				"decl": "asParam(parent: Param): ReturnType<typeof $genart.params.color>;",
				"impl": [
					"asParam(parent: Param) {",
					"return $genart.params.color({",
					"...parent.asParam(),",
					"default: this.default.deref() || undefined,",
					"});",
					"}"
				]
			}
		}
	},
	{
		"name": "RangeParam",
		"type": "struct",
		"fields": [
			{
				"name": "default",
				"type": "f64",
				"setter": false,
				"default": { "zig": "std.math.inf(f64)" }
			},
			{ "name": "min", "type": "f64", "default": 0, "setter": false },
			{ "name": "max", "type": "f64", "default": 100, "setter": false },
			{ "name": "step", "type": "f64", "default": 1, "setter": false },
			{ "name": "exponent", "type": "f64", "default": 1, "setter": false }
		],
		"body": {
			"ts": {
				"decl": "asParam(parent: Param): ReturnType<typeof $genart.params.range>;",
				"impl": [
					"asParam(parent: Param) {",
					"return $genart.params.range({",
					"...parent.asParam(),",
					"default: isFinite(this.default) ? this.default : undefined,",
					"min: this.min,",
					"max: this.max,",
					"step: this.step,",
					"exponent: this.exponent,",
					"});",
					"}"
				]
			}
		}
	},
	{
		"name": "TextParam",
		"type": "struct",
		"fields": [
			{
				"name": "default",
				"type": "string",
				"setter": false
			},
			{
				"name": "match",
				"type": "string",
				"optional": true,
				"setter": false,
				"default": { "zig": "null" }
			},
			{ "name": "min", "type": "usize", "default": 0, "setter": false },
			{ "name": "max", "type": "usize", "default": 0, "setter": false },
			{ "name": "multiline", "type": "u8", "default": 0, "setter": false }
		],
		"body": {
			"ts": {
				"decl": "asParam(parent: Param): ReturnType<typeof $genart.params.text>;",
				"impl": [
					"asParam(parent: Param) {",
					"return $genart.params.text({",
					"...parent.asParam(),",
					"default: this.default.deref(),",
					"match: this.match.deref() || undefined,",
					"min: this.min || undefined,",
					"max: this.max || undefined,",
					"multiline: !!this.multiline,",
					"});",
					"}"
				]
			}
		}
	}
]
