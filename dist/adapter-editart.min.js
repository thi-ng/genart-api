"use strict";(()=>{globalThis.drawArt=()=>{};var o=5,g=["choice","range","toggle","weighted"],{math:{clamp:l,round:u,fit:p,mix:P},prng:{sfc32:w},utils:{isString:h}}=$genart,d=class{paramIndex={};searchParams;cache={};_prng;_screen;constructor(){this.searchParams=new URLSearchParams(location.search),this._screen=this.screen,this.initPRNG(),$genart.on("genart:param-change",({paramID:e,param:r})=>{let a=this.paramIndex[e];if(a==null)return;let t=this.serializeParam(r);t==null||this.cache[e]===t||(this.cache[e]=t,this.searchParams.set("m"+a,t),this.reload())}),$genart.on("genart:state-change",({state:e})=>{e==="ready"&&$genart.start()}),window.addEventListener("message",e=>{var r=e.data;r.hasOwnProperty("editartQueryString")&&(this.searchParams=new URLSearchParams(r.editartQueryString),this.reload())}),window.addEventListener("resize",()=>{let{width:e,height:r,dpr:a}=this._screen,t=this.screen;(e!==t.width||r!==t.height||a!==t.dpr)&&(this._screen=t,$genart.emit({type:"genart:resize",screen:t}))})}get id(){return"@genart-api/adapter-editart"}get mode(){return"play"}get screen(){return{width:window.innerWidth,height:window.innerHeight,dpr:window.devicePixelRatio||1}}get prng(){return this._prng}async updateParam(e,r){let a=this.paramIndex[e];if(a==null){g.includes(r.type)||console.warn(`${this.id}: ignoring unsupported param: ${e} (type: ${r.type})`);return}let t=this.searchParams.get("m"+a);if(t==null||this.cache[e]===t)return;this.cache[e]=t;let i=l(+t,0,.999999);switch(r.type){case"choice":{let n=r.options,s=n[i*n.length|0];return{value:h(s)?s:s[0]}}case"range":{let{min:n,max:s,step:m}=r;return{value:l(u(P(n,s,i),m),n,s)}}case"toggle":return{value:i>=.5};case"weighted":{let n=r.options;return{value:n[i*n.length|0][1]}}}}async initParams(e){let r=Object.entries(e).filter(([t,i])=>i.edit!=="private"&&g.includes(i.type)).sort((t,i)=>{let n=t[1].order,s=i[1].order;return n===s?t[0]<i[0]?-1:t[0]>i[0]?1:0:n-s}),a=r.length;a>o&&(console.warn(`${this.id}: found ${a} eligible params, but platform only supports max. ${o} params`),console.warn("using these params only (in order):",r.map(t=>t[0]))),a=Math.min(o,a);for(let t=0;t<a;t++)this.paramIndex[r[t][0]]=t}capture(e){triggerPreview()}reload(){console.log(`${this.id} reloading with new params:`,this.searchParams.toString()),location.search=this.searchParams.toString()}initPRNG(){let e=randomSeedEditArt;for(let t=0;t<o;t++)e+=this.searchParams.get("m"+t)||"0.5";let r=f(e),a=()=>w(r);this._prng={seed:e,rnd:a(),reset:a}}serializeParam(e){switch(e.type){case"choice":{let r=e.options;return(r.findIndex(a=>(h(a)?a:a[0])===e.value)/r.length).toFixed(3)}case"range":{let{min:r,max:a}=e;return p(e.value,r,a,0,1).toFixed(6)}case"toggle":return e.value>=.5?"1":"0";case"weighted":{let r=e.options;return(r.findIndex(a=>(h(a)?a:a[1])===e.value)/r.length).toFixed(3)}default:return String(e.value)}}},f=c=>{let e=1779033703,r=3144134277,a=1013904242,t=2773480762;for(let i=0,n;i<c.length;i++)n=c.charCodeAt(i),e=r^Math.imul(e^n,597399067),r=a^Math.imul(r^n,2869860233),a=t^Math.imul(a^n,951274213),t=e^Math.imul(t^n,2716044179);return e=Math.imul(a^e>>>18,597399067),r=Math.imul(t^r>>>22,2869860233),a=Math.imul(e^a>>>17,951274213),t=Math.imul(r^t>>>19,2716044179),[(e^r^a^t)>>>0,(r^e)>>>0,(a^e)>>>0,(t^e)>>>0]};$genart.setAdapter(new d);})();
