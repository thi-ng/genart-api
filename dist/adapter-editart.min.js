"use strict";(()=>{globalThis.drawArt=()=>{};var o=5,g=["choice","range","toggle","weighted"],{math:{clamp:l,round:u,fit:p,mix:P},prng:{sfc32:f},utils:{isString:h}}=$genart,d=class{_paramIndex={};_searchParams;_selectedParamIDs;_cache={};_prng;_screen;constructor(){this._searchParams=new URLSearchParams(location.search),this._screen=this.screen,this.initPRNG(),$genart.on("genart:param-change",({paramID:e,param:r})=>{let t=this._paramIndex[e];if(t==null)return;let a=this.serializeParam(r);a==null||this._cache[e]===a||(this._cache[e]=a,this._searchParams.set("m"+t,a),this.reload())}),$genart.on("genart:state-change",({state:e})=>{e==="ready"&&$genart.start()}),window.addEventListener("message",e=>{e.data.hasOwnProperty("editartQueryString")&&(this._searchParams=new URLSearchParams(e.data.editartQueryString),this.reload())}),window.addEventListener("resize",()=>{let{width:e,height:r,dpr:t}=this._screen,a=this.screen;(e!==a.width||r!==a.height||t!==a.dpr)&&(this._screen=a,$genart.emit({type:"genart:resize",screen:a}))})}get id(){return"@genart-api/adapter-editart"}get mode(){return"play"}get screen(){return{width:window.innerWidth,height:window.innerHeight,dpr:window.devicePixelRatio||1}}get prng(){return this._prng}configure(e){if(e.params){if(e.params.length>o)throw new Error(`${this.id}: only max. ${o} can be selected`);this._selectedParamIDs=e.params}}async updateParam(e,r){let t=this._paramIndex[e];if(t==null){g.includes(r.type)||this.warn(`ignoring unsupported param: ${e} (type: ${r.type})`);return}let a=this._searchParams.get("m"+t)||"0.5";if(this._cache[e]===a)return;this._cache[e]=a;let i=l(+a,0,.999999);switch(r.type){case"choice":{let n=r.options,s=n[i*n.length|0];return{value:h(s)?s:s[0]}}case"range":{let{min:n,max:s,step:m}=r;return{value:l(u(P(n,s,i),m),n,s)}}case"toggle":return{value:i>=.5};case"weighted":{let n=r.options;return{value:n[i*n.length|0][1]}}}}async initParams(e){let r=[];if(this._selectedParamIDs)for(let t of this._selectedParamIDs){let a=e[t];a?r.push([t,a]):this.warn(`can't select unknown param: ${t}, skipping...`)}else{for(let t of Object.entries(e))t[1].edit!=="private"&&g.includes(t[1].type)&&r.push(t);r.length>o&&(this.warn(`found ${r.length} eligible params, but platform only supports max. ${o} params`),r=r.slice(0,o),this.warn("only using these params (in order):",r.map(t=>t[0]))),r.sort((t,a)=>{let i=t[1].order,n=a[1].order;return i===n?t[0]<a[0]?-1:t[0]>a[0]?1:0:i-n})}for(let t=0,a=r.length;t<a;t++)this._paramIndex[r[t][0]]=t}capture(e){triggerPreview()}reload(){console.log(`${this.id} reloading with new params:`,this._searchParams.toString()),location.search=this._searchParams.toString()}initPRNG(){let e=randomSeedEditArt;for(let a=0;a<o;a++)e+=this._searchParams.get("m"+a)||"0.5";let r=w(e),t=()=>f(r);this._prng={seed:e,rnd:t(),reset:t}}serializeParam(e){switch(e.type){case"choice":{let r=e.options;return(r.findIndex(t=>(h(t)?t:t[0])===e.value)/r.length).toFixed(3)}case"range":{let{min:r,max:t}=e;return p(e.value,r,t,0,1).toFixed(6)}case"toggle":return e.value>=.5?"1":"0";case"weighted":{let r=e.options;return(r.findIndex(t=>(h(t)?t:t[1])===e.value)/r.length).toFixed(3)}default:return String(e.value)}}warn(e,...r){console.warn(`${this.id}:`,e,...r)}},w=c=>{let e=1779033703,r=3144134277,t=1013904242,a=2773480762;for(let i=0,n;i<c.length;i++)n=c.charCodeAt(i),e=r^Math.imul(e^n,597399067),r=t^Math.imul(r^n,2869860233),t=a^Math.imul(t^n,951274213),a=e^Math.imul(a^n,2716044179);return e=Math.imul(t^e>>>18,597399067),r=Math.imul(a^r>>>22,2869860233),t=Math.imul(e^t>>>17,951274213),a=Math.imul(r^a>>>19,2716044179),[(e^r^t^a)>>>0,(r^e)>>>0,(t^e)>>>0,(a^e)>>>0]};$genart.setAdapter(new d);})();
