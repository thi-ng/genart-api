"use strict";(()=>{var g=i=>{let e=new Uint32Array(4);return e.set(i),()=>{let a=(e[0]+e[1]>>>0)+e[3]>>>0;return e[3]=e[3]+1>>>0,e[0]=e[1]^e[1]>>>9,e[1]=e[2]+(e[2]<<3)>>>0,e[2]=(e[2]<<21|e[2]>>>11)+a>>>0,a/4294967296}};var l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",p=i=>{let e=Array.isArray(i)?new Uint8Array(i):new Uint8Array(i.buffer,i.byteOffset,i.byteLength),a=e.length,t=(a/3|0)*3,s=r=>l[r>>18&63]+l[r>>12&63],n=r=>s(r)+l[r>>6&63],m="";for(let r=0;r<t;r+=3){let o=e[r]<<16|e[r+1]<<8|e[r+2];m+=n(o)+l[o&63]}return m+=a-t===1?s(e[a-1]<<16)+"==":a-t===2?n(e[a-2]<<16|e[a-1]<<8)+"=":"",m},h=i=>{let e=/=*$/.exec(i),a=i.length-(e?.[0].length??0),t=new Uint8Array(a/4*3),s=0;for(let n=0,m=0;n<a;){let r=l.indexOf(i[n]);s=n&3?(s<<6)+r:r,n++&3&&(t[m++]=255&s>>(-2*n&6))}return t};var{math:{clamp01:f,parseNum:u},utils:{formatValuePrec:v}}=$genart,c="__autostart",w="__width",P="__height",y="__seed",d=class{params;_cache={};_random;constructor(){this.params=new URLSearchParams(location.search),this.initPRNG(),$genart.on("genart:paramchange",e=>{let a=this.serializeParam(e.param);this.params.set(e.paramID,a),parent.postMessage({type:"paramadapter:update",params:this.params.toString()},"*"),e.param.update==="reload"&&(console.log("reloading w/",this.params.toString()),location.search=this.params.toString())}),$genart.on("genart:statechange",({state:e})=>{e==="ready"&&this.params.get(c)!=="0"&&$genart.start()})}get mode(){return this.params.get("__mode")||"play"}get screen(){return{width:u(this.params.get(w),window.innerWidth),height:u(this.params.get(P),window.innerHeight),dpr:u(this.params.get("__dpr"),window.devicePixelRatio||1)}}get prng(){return this._random}async setParams(e){return Object.assign(e,{[y]:$genart.params.range({name:"PRNG seed",desc:"Manually defined seed value",min:0,max:1e13,default:Number(BigInt(this._random.seed)),update:"reload",widget:"precise"}),[w]:$genart.params.range({name:"Width",desc:"Canvas width",min:100,max:16384,default:window.innerWidth,randomize:!1,update:"reload",widget:"precise"}),[P]:$genart.params.range({name:"Height",desc:"Canvas height",min:100,max:16384,default:window.innerHeight,randomize:!1,update:"reload",widget:"precise"}),[c]:$genart.params.toggle({name:"Autostart",desc:"If enabled, artwork will start playing automatically",default:this.params.get(c)!=="0",randomize:!1,update:"reload"})}),e}async updateParam(e,a){let t=this.params.get(e);if(!(t==null||this._cache[e]===t))switch(this._cache[e]=t,a.type){case"color":case"choice":case"text":case"time":case"weighted":return{value:t};case"date":case"datetime":return{value:new Date(Date.parse(t))};case"img":return{value:h(t)};case"numlist":return{value:t.split(",").map(s=>u(s))};case"range":return{value:+t};case"ramp":{let[s,...n]=t.split(",");if(!s||n.length<4||n.length&1){$genart.paramError(e);return}let m={l:"linear",s:"smooth",e:"exp"}[s]||"linear",r=[];for(let o=0;o<n.length;o+=2)r.push([f(u(n[o])),f(u(n[o+1]))]);return r.sort((o,b)=>o[0]-b[0]),{update:{mode:m,stops:r.flat()}}}case"strlist":return{value:t.split(",")};case"toggle":return{value:t==="1"};case"xy":return{value:t.split(",").map(s=>+s)}}}serializeParam(e){switch(e.type){case"color":return e.value.substring(1);case"date":return e.value.toISOString().substring(0,10);case"datetime":return e.value.toISOString();case"img":return p(e.value);case"numlist":case"strlist":return e.value.join(",");case"ramp":{let a=e;return a.mode[0]+","+a.stops.flatMap(t=>t).join(",")}case"range":return v(e.step)(e.value);case"time":return e.value.join(":");case"toggle":return e.value?1:0;case"xy":return e.value.map(a=>a.toFixed(3)).join(",");default:return e.value}}capture(e){console.log("TODO handle capture...",e)}initPRNG(){let e=this.params.get(y),a=BigInt(e??Date.now()),t=0xffffffffn,s=()=>n.rnd=g([Number(a>>96n&t)>>>0,Number(a>>64n&t)>>>0,Number(a>>32n&t)>>>0,Number(a&t)>>>0]),n={seed:"0x"+a.toString(16),reset:s};s(),this._random=n}};$genart.setAdapter(new d);})();
