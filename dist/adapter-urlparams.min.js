"use strict";(()=>{var d=i=>{let e=new Uint32Array(4);return e.set(i),()=>{let t=(e[0]+e[1]>>>0)+e[3]>>>0;return e[3]=e[3]+1>>>0,e[0]=e[1]^e[1]>>>9,e[1]=e[2]+(e[2]<<3)>>>0,e[2]=(e[2]<<21|e[2]>>>11)+t>>>0,t/4294967296}};var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",p=i=>{let e=Array.isArray(i)?new Uint8Array(i):new Uint8Array(i.buffer,i.byteOffset,i.byteLength),t=e.length,a=(t/3|0)*3,r=n=>u[n>>18&63]+u[n>>12&63],s=n=>r(n)+u[n>>6&63],m="";for(let n=0;n<a;n+=3){let o=e[n]<<16|e[n+1]<<8|e[n+2];m+=s(o)+u[o&63]}return m+=t-a===1?r(e[t-1]<<16)+"==":t-a===2?s(e[t-2]<<16|e[t-1]<<8)+"=":"",m},h=i=>{let e=/=*$/.exec(i),t=i.length-(e?.[0].length??0),a=new Uint8Array(t/4*3),r=0;for(let s=0,m=0;s<t;){let n=u.indexOf(i[s]);r=s&3?(r<<6)+n:n,s++&3&&(a[m++]=255&r>>(-2*s&6))}return a};var{math:{clamp01:f,parseNum:c},utils:{formatValuePrec:b}}=$genart,l="__autostart",w="__width",P="__height",y="__seed",g=class{params;cache={};_prng;_screen;constructor(){this.params=new URLSearchParams(location.search),this._screen=this.screen,this.initPRNG(),$genart.on("genart:paramchange",e=>{let t=this.serializeParam(e.param);this.params.set(e.paramID,t),parent.postMessage({type:"paramadapter:update",params:this.params.toString()},"*"),e.param.update==="reload"&&(console.log("reloading w/",this.params.toString()),location.search=this.params.toString())}),$genart.on("genart:statechange",({state:e})=>{e==="ready"&&this.params.get(l)!=="0"&&$genart.start()}),window.addEventListener("resize",()=>{let{width:e,height:t,dpr:a}=this._screen,r=this.screen;(e!==r.width||t!==r.height||a!==r.dpr)&&(this._screen=r,$genart.emit({type:"genart:resize",screen:r}))})}get mode(){return this.params.get("__mode")||"play"}get screen(){return{width:c(this.params.get(w),window.innerWidth),height:c(this.params.get(P),window.innerHeight),dpr:c(this.params.get("__dpr"),window.devicePixelRatio||1)}}get prng(){return this._prng}async setParams(e){return Object.assign(e,{[y]:$genart.params.range({name:"PRNG seed",desc:"Manually defined seed value",min:0,max:1e13,default:Number(BigInt(this._prng.seed)),update:"reload",widget:"precise"}),[w]:$genart.params.range({name:"Width",desc:"Canvas width",min:100,max:16384,default:window.innerWidth,randomize:!1,update:"reload",widget:"precise"}),[P]:$genart.params.range({name:"Height",desc:"Canvas height",min:100,max:16384,default:window.innerHeight,randomize:!1,update:"reload",widget:"precise"}),[l]:$genart.params.toggle({name:"Autostart",desc:"If enabled, artwork will start playing automatically",default:this.params.get(l)!=="0",randomize:!1,update:"reload"})}),e}async updateParam(e,t){let a=this.params.get(e);if(!(a==null||this.cache[e]===a))switch(this.cache[e]=a,t.type){case"color":case"choice":case"text":case"time":case"weighted":return{value:a};case"date":case"datetime":return{value:new Date(Date.parse(a))};case"img":return{value:h(a)};case"numlist":return{value:a.split(",").map(r=>c(r))};case"range":return{value:+a};case"ramp":{let[r,...s]=a.split(",");if(!r||s.length<4||s.length&1){$genart.paramError(e);return}let m={l:"linear",s:"smooth",e:"exp"}[r]||"linear",n=[];for(let o=0;o<s.length;o+=2)n.push([f(c(s[o])),f(c(s[o+1]))]);return n.sort((o,v)=>o[0]-v[0]),{update:{mode:m,stops:n.flat()}}}case"strlist":return{value:a.split(",")};case"toggle":return{value:a==="1"};case"xy":return{value:a.split(",").map(r=>+r)}}}serializeParam(e){switch(e.type){case"color":return e.value.substring(1);case"date":return e.value.toISOString().substring(0,10);case"datetime":return e.value.toISOString();case"img":return p(e.value);case"numlist":case"strlist":return e.value.join(",");case"ramp":{let t=e;return t.mode[0]+","+t.stops.flatMap(a=>a).join(",")}case"range":return b(e.step)(e.value);case"time":return e.value.join(":");case"toggle":return e.value?1:0;case"xy":return e.value.map(t=>t.toFixed(3)).join(",");default:return e.value}}capture(e){console.log("TODO handle capture...",e)}initPRNG(){let e=this.params.get(y),t=BigInt(e??Date.now()),a=0xffffffffn,r=()=>s.rnd=d([Number(t>>96n&a)>>>0,Number(t>>64n&a)>>>0,Number(t>>32n&a)>>>0,Number(t&a)>>>0]),s={seed:"0x"+t.toString(16),reset:r};r(),this._prng=s}};$genart.setAdapter(new g);})();
