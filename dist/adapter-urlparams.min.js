"use strict";(()=>{var p=o=>{let e=new Uint32Array(4);return e.set(o),()=>{let t=(e[0]+e[1]>>>0)+e[3]>>>0;return e[3]=e[3]+1>>>0,e[0]=e[1]^e[1]>>>9,e[1]=e[2]+(e[2]<<3)>>>0,e[2]=(e[2]<<21|e[2]>>>11)+t>>>0,t/4294967296}};var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",g=o=>{let e=Array.isArray(o)?new Uint8Array(o):new Uint8Array(o.buffer,o.byteOffset,o.byteLength),t=e.length,a=(t/3|0)*3,s=r=>c[r>>18&63]+c[r>>12&63],n=r=>s(r)+c[r>>6&63],m="";for(let r=0;r<a;r+=3){let i=e[r]<<16|e[r+1]<<8|e[r+2];m+=n(i)+c[i&63]}return m+=t-a===1?s(e[t-1]<<16)+"==":t-a===2?n(e[t-2]<<16|e[t-1]<<8)+"=":"",m},h=o=>{let e=/=*$/.exec(o),t=o.length-(e?.[0].length??0),a=new Uint8Array(t/4*3),s=0;for(let n=0,m=0;n<t;){let r=c.indexOf(o[n]);s=n&3?(s<<6)+r:r,n++&3&&(a[m++]=255&s>>(-2*n&6))}return a};var{math:{clamp01:d,parseNum:u}}=$genart,l=class{params;cache={};constructor(){this.params=new URLSearchParams(location.search),$genart.on("genart:paramchange",e=>{let t=this.serializeParam(e.spec);this.params.set(e.paramID,t),parent.postMessage({type:"paramadapter:update",params:this.params.toString()},"*"),e.spec.update==="reload"&&(console.log("reloading w/",this.params.toString()),location.search=this.params.toString())}),$genart.on("genart:statechange",({state:e})=>e==="ready"&&$genart.start())}get mode(){return this.params.get("__mode")||"play"}get screen(){return{width:u(this.params.get("__width"),window.innerWidth),height:u(this.params.get("__height"),window.innerHeight),dpr:u(this.params.get("__dpr"),window.devicePixelRatio||1)}}get prng(){let e=this.params.get("__seed"),t=BigInt(e?"0x"+e:Date.now()),a=0xffffffffn,s=()=>n.rnd=p([Number(t>>96n&a)>>>0,Number(t>>64n&a)>>>0,Number(t>>32n&a)>>>0,Number(t&a)>>>0]),n={seed:t.toString(16),reset:s};return s(),n}async setParams(e){return!0}async updateParam(e,t){let a=this.params.get(e);if(!(!a||this.cache[e]===a))switch(this.cache[e]=a,t.type){case"color":case"choice":case"text":case"time":case"weighted":return{value:a};case"date":case"datetime":return{value:new Date(Date.parse(a))};case"img":return{value:h(a)};case"numlist":return{value:a.split(",").map(s=>u(s))};case"range":return{value:+a};case"ramp":{let[s,...n]=a.split(",");if(!s||n.length<4||n.length&1){$genart.paramError(e);return}let m={l:"linear",s:"smooth",e:"exp"}[s]||"linear",r=[];for(let i=0;i<n.length;i+=2)r.push([d(u(n[i])),d(u(n[i+1]))]);return r.sort((i,f)=>i[0]-f[0]),{update:{mode:m,stops:r.flat()}}}case"strlist":return{value:a.split(",")};case"toggle":return{value:a==="1"};case"xy":return{value:a.split(",").map(s=>+s)}}}serializeParam(e){switch(e.type){case"color":return e.value.substring(1);case"date":return e.value.toISOString().substring(0,10);case"datetime":return e.value.toISOString();case"img":return g(e.value);case"numlist":case"strlist":return e.value.join(",");case"ramp":{let t=e;return t.mode[0]+","+t.stops.flatMap(a=>a).join(",")}case"time":return e.value.join(":");case"toggle":return e.value?1:0;case"xy":return e.value.map(t=>t.toFixed(3)).join(",");default:return e.value}}capture(e){console.log("TODO handle capture...",e)}};$genart.setAdapter(new l);})();
