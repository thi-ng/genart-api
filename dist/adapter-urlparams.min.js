"use strict";(()=>{var d=s=>{let e=Array.isArray(s)?s:new Uint8Array(s.buffer,s.byteOffset,s.byteLength);return btoa(String.fromCharCode(...e))},g=s=>new Uint8Array([...atob(s)].map(e=>e.charCodeAt(0)));var l=async(s,e)=>new Uint8Array(await new Response(new Blob([s]).stream().pipeThrough(e)).arrayBuffer()),u=(s,e="gzip")=>l(s,new CompressionStream(e)),h=(s,e="gzip")=>l(s,new DecompressionStream(e));var{math:{clamp01:f,parseNum:o},prng:{sfc32:S},utils:{formatValuePrec:y}}=$genart,p="__autostart",w="__width",P="__height",v="__dpr",b="__seed",c=class{params;cache={};_prng;_screen;constructor(){this.params=new URLSearchParams(location.search),this._screen=this.screen,this.initPRNG(),$genart.on("genart:param-change",async e=>{let a=await this.serializeParam(e.param);this.params.set(e.paramID,a),parent.postMessage({type:`${this.id}:set-params`,params:this.params.toString()},"*"),e.param.update==="reload"&&(console.log("reloading w/",this.params.toString()),location.search=this.params.toString())}),$genart.on("genart:state-change",({state:e})=>{e==="ready"&&this.params.get(p)!=="0"&&$genart.start()}),window.addEventListener("resize",()=>{let{width:e,height:a,dpr:t}=this._screen,r=this.screen;(e!==r.width||a!==r.height||t!==r.dpr)&&(this._screen=r,$genart.emit({type:"genart:resize",screen:r}))}),parent.postMessage({type:`${this.id}:set-params`,params:this.params.toString()},"*")}get id(){return"@genart-api/adapter-urlparams"}get mode(){return this.params.get("__mode")||"play"}get screen(){return{width:o(this.params.get(w),window.innerWidth),height:o(this.params.get(P),window.innerHeight),dpr:o(this.params.get(v),window.devicePixelRatio||1)}}get prng(){return this._prng}augmentParams(e){let a=this.id;return Object.assign(e,{[b]:$genart.params.range({group:a,order:0,name:"PRNG seed",desc:"Manually defined seed value",min:0,max:1e13,default:Number(BigInt(this._prng.seed)),update:"reload",widget:"precise"}),[w]:$genart.params.range({group:a,order:1,name:"Width",desc:"Canvas width",min:100,max:16384,default:this._screen.width,randomize:!1,update:"reload",widget:"precise"}),[P]:$genart.params.range({group:a,order:2,name:"Height",desc:"Canvas height",min:100,max:16384,default:this._screen.height,randomize:!1,update:"reload",widget:"precise"}),[v]:$genart.params.range({group:a,order:3,name:"DPR",desc:"Device pixel ratio",min:1,max:4,default:this._screen.dpr,randomize:!1,update:"reload",widget:"precise"}),[p]:$genart.params.toggle({group:a,order:4,name:"Autostart",desc:"If enabled, artwork will start playing automatically",default:this.params.get(p)!=="0",randomize:!1,update:"reload"})})}async updateParam(e,a){let t=this.params.get(e);if(!(t==null||this.cache[e]===t))switch(this.cache[e]=t,a.type){case"color":case"choice":case"text":case"time":case"weighted":return{value:t};case"date":case"datetime":return{value:new Date(Date.parse(t))};case"img":return{value:await h(g(t))};case"numlist":return{value:t.split(",").map(r=>o(r))};case"range":return{value:+t};case"ramp":{let[r,...n]=t.split(",");if(!r||n.length<4||n.length&1){$genart.paramError(e);return}let _={l:"linear",s:"smooth",e:"exp"}[r]||"linear",m=[];for(let i=0;i<n.length;i+=2)m.push([f(o(n[i])),f(o(n[i+1]))]);return m.sort((i,R)=>i[0]-R[0]),{update:{mode:_,stops:m.flat()}}}case"strlist":return{value:t.split(",")};case"toggle":return{value:t==="1"};case"vector":case"xy":return{value:t.split(",").map(r=>+r)}}}async serializeParam(e){switch(e.type){case"color":return e.value.substring(1);case"date":return e.value.toISOString().substring(0,10);case"datetime":return e.value.toISOString();case"img":return d(await u(e.value));case"numlist":case"strlist":return e.value.join(",");case"ramp":{let a=e;return a.mode[0]+","+a.stops.flat().map(t=>t.toFixed(3)).join(",")}case"range":return y(e.step)(e.value);case"time":return e.value.join(":");case"toggle":return e.value?1:0;case"vector":case"xy":{let a=e,t=Array.isArray(a.step)?a.step[0]:.001;return a.value.map(y(t)).join(",")}default:return e.value}}capture(e){console.log("TODO handle capture...",e)}initPRNG(){let e=this.params.get(b),a=BigInt(e??Math.floor(Math.random()*1e13)),t=0xffffffffn,r=()=>n.rnd=S([Number(a>>96n&t)>>>0,Number(a>>64n&t)>>>0,Number(a>>32n&t)>>>0,Number(a&t)>>>0]),n={seed:"0x"+a.toString(16),reset:r};r(),this._prng=n}};$genart.setAdapter(new c);})();
