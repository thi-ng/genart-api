"use strict";(()=>{var u=c=>{let e=new Uint32Array(4);return e.set(c),()=>{let a=(e[0]+e[1]>>>0)+e[3]>>>0;return e[3]=e[3]+1>>>0,e[0]=e[1]^e[1]>>>9,e[1]=e[2]+(e[2]<<3)>>>0,e[2]=(e[2]<<21|e[2]>>>11)+a>>>0,a/4294967296}};var{math:{clamp01:p,parseNum:o}}=$genart,m=class{params;cache={};constructor(){this.params=new URLSearchParams(location.search),$genart.on("genart:paramchange",e=>{let a=this.serializeParam(e.spec);this.params.set(e.paramID,a),parent.postMessage({type:"paramadapter:update",params:this.params.toString()}),e.spec.update==="reload"&&(console.log("reloading w/",this.params.toString()),location.search=this.params.toString())}),$genart.on("genart:statechange",({state:e})=>e==="ready"&&$genart.start())}get mode(){return this.params.get("__mode")||"play"}get screen(){return{width:o(this.params.get("__width"),window.innerWidth),height:o(this.params.get("__height"),window.innerHeight),dpr:o(this.params.get("__dpr"),window.devicePixelRatio||1)}}get prng(){let e=this.params.get("__seed"),a=BigInt(e?"0x"+e:Date.now()),t=0xffffffffn,s=()=>r.rnd=u([Number(a>>96n&t)>>>0,Number(a>>64n&t)>>>0,Number(a>>32n&t)>>>0,Number(a&t)>>>0]),r={seed:a.toString(16),reset:s};return s(),r}async setParams(e){return!0}async updateParam(e,a){let t=this.params.get(e);if(!(!t||this.cache[e]===t))switch(this.cache[e]=t,a.type){case"color":case"choice":case"text":case"time":case"weighted":return{value:t};case"range":return{value:+t};case"toggle":return{value:t==="1"};case"ramp":{let[s,...r]=t.split(",");if(!s||r.length<4||r.length&1){$genart.paramError(e);return}let i=a;i.mode={l:"linear",s:"smooth",e:"exp"}[s]||"linear",i.stops=[];for(let n=0;n<r.length;n+=2)i.stops.push([p(o(r[n])),p(o(r[n+1]))]);return i.stops.sort((n,l)=>n[0]-l[0]),{update:!0}}case"xy":return{value:t.split(",").map(s=>+s)};case"date":case"datetime":return{value:new Date(Date.parse(t))}}}serializeParam(e){switch(e.type){case"color":return e.value.substring(1);case"date":return e.value.toISOString().substring(0,10);case"datetime":return e.value.toISOString();case"time":return e.value.join(":");case"ramp":{let a=e;return a.mode[0]+","+a.stops.flatMap(t=>t).join(",")}case"toggle":return e.value?1:0;case"xy":return e.value.join(",");default:return e.value}}capture(e){console.log("TODO handle capture...",e)}};$genart.setAdapter(new m);})();
