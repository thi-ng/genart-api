"use strict";(()=>{var d=r=>{let e=Array.isArray(r)?r:new Uint8Array(r.buffer,r.byteOffset,r.byteLength);return btoa(String.fromCharCode(...e))},g=r=>new Uint8Array([...atob(r)].map(e=>e.charCodeAt(0)));var l=async(r,e)=>new Uint8Array(await new Response(new Blob([r]).stream().pipeThrough(e)).arrayBuffer()),u=(r,e="gzip")=>l(r,new CompressionStream(e)),h=(r,e="gzip")=>l(r,new DecompressionStream(e));var{math:{clamp01:y,parseNum:n},prng:{SFC32:$,randomBigInt:x},utils:{formatValuePrec:f,parseBigInt128:C,stringifyBigInt:w}}=$genart,c="__autostart",P="__width",_="__height",v="__dpr",b="__seed",D="__mode",E="__collector",I="__iteration",R=1n<<128n,p=class{params;cache={};_prng;_seed;_screen;constructor(){this.params=new URLSearchParams(location.search),this._screen=this.screen,this.initPRNG(),$genart.on("genart:param-change",async e=>{let a=await this.serializeParam(e.param);this.params.set(e.paramID,a),parent.postMessage({type:`${this.id}:set-params`,params:this.params.toString()},"*"),e.param.update==="reload"&&(console.log("reloading w/",this.params.toString()),location.search=this.params.toString())}),$genart.on("genart:state-change",({state:e})=>{e==="ready"&&this.params.get(c)!=="0"&&$genart.start()}),window.addEventListener("resize",()=>{let{width:e,height:a,dpr:t}=this._screen,s=this.screen;(e!==s.width||a!==s.height||t!==s.dpr)&&(this._screen=s,$genart.emit({type:"genart:resize",screen:s}))}),parent.postMessage({type:`${this.id}:set-params`,params:this.params.toString()},"*")}get id(){return"@genart-api/adapter-urlparams"}get mode(){return this.params.get(D)||"play"}get collector(){return this.params.get(E)??void 0}get iteration(){let e=this.params.get(I);return e?n(e,0):void 0}get screen(){return{width:n(this.params.get(P),window.innerWidth),height:n(this.params.get(_),window.innerHeight),dpr:n(this.params.get(v),window.devicePixelRatio||1)}}get prng(){return this._prng}get seed(){return this._seed}augmentParams(e){let a=this.id;return{...e,[b]:$genart.params.bigint({group:a,order:0,name:"PRNG seed",desc:"Manually defined seed value",min:0n,max:R-1n,default:BigInt(this._seed),update:"reload"}),[P]:$genart.params.range({group:a,order:1,name:"Width",desc:"Canvas width",min:100,max:16384,default:this._screen.width,randomize:!1,update:"reload",widget:"precise"}),[_]:$genart.params.range({group:a,order:2,name:"Height",desc:"Canvas height",min:100,max:16384,default:this._screen.height,randomize:!1,update:"reload",widget:"precise"}),[v]:$genart.params.range({group:a,order:3,name:"DPR",desc:"Device pixel ratio",min:1,max:4,default:this._screen.dpr,randomize:!1,update:"reload",widget:"precise"}),[c]:$genart.params.toggle({group:a,order:4,name:"Autostart",desc:"If enabled, artwork will start playing automatically",default:this.params.get(c)!=="0",randomize:!1,update:"reload"})}}async updateParam(e,a){let t=this.params.get(e);if(!(t==null||this.cache[e]===t))switch(this.cache[e]=t,a.type){case"bigint":case"color":case"choice":case"text":case"time":case"weighted":return{value:t};case"date":case"datetime":return{value:new Date(Date.parse(t))};case"binary":case"image":return{value:await h(g(t))};case"numlist":return{value:t.split(",").map(s=>n(s))};case"range":return{value:+t};case"ramp":{let[s,...o]=t.split(",");if(!s||o.length<4||o.length&1){$genart.paramError(e);return}let S={l:"linear",s:"smooth",e:"exp"}[s]||"linear",m=[];for(let i=0;i<o.length;i+=2)m.push([y(n(o[i])),y(n(o[i+1]))]);return m.sort((i,A)=>i[0]-A[0]),{update:{mode:S,stops:m.flat()}}}case"strlist":return{value:t.split(",")};case"toggle":return{value:t==="1"};case"vector":case"xy":return{value:t.split(",").map(s=>+s)}}}async serializeParam(e){switch(e.type){case"bigint":return w(e.value,16);case"binary":case"image":return d(await u(e.value));case"color":return e.value.substring(1);case"date":return e.value.toISOString().substring(0,10);case"datetime":return e.value.toISOString();case"numlist":case"strlist":return e.value.join(",");case"ramp":{let a=e;return a.mode[0]+","+a.stops.flat().map(t=>t.toFixed(3)).join(",")}case"range":return f(e.step)(e.value);case"time":return e.value.join(":");case"toggle":return e.value?1:0;case"vector":case"xy":{let a=e,t=Array.isArray(a.step)?a.step[0]:.001;return a.value.map(f(t)).join(",")}default:return e.value}}capture(e){console.log("TODO handle capture...",e)}initPRNG(){let e=this.params.get(b),a=e?BigInt(e):x(R);this._seed=w(a),this._prng=new $(C(a))}};$genart.setAdapter(new p);})();
