"use strict";(()=>{var g=n=>{let e=new Uint32Array(4);return e.set(n),()=>{let t=(e[0]+e[1]>>>0)+e[3]>>>0;return e[3]=e[3]+1>>>0,e[0]=e[1]^e[1]>>>9,e[1]=e[2]+(e[2]<<3)>>>0,e[2]=(e[2]<<21|e[2]>>>11)+t>>>0,t/4294967296}};var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",h=n=>{let e=Array.isArray(n)?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength),t=e.length,a=(t/3|0)*3,r=s=>c[s>>18&63]+c[s>>12&63],i=s=>r(s)+c[s>>6&63],m="";for(let s=0;s<a;s+=3){let o=e[s]<<16|e[s+1]<<8|e[s+2];m+=i(o)+c[o&63]}return m+=t-a===1?r(e[t-1]<<16)+"==":t-a===2?i(e[t-2]<<16|e[t-1]<<8)+"=":"",m},f=n=>{let e=n.length-(/=*$/.exec(n)?.[0].length??0),t=new Uint8Array(e/4*3),a=0;for(let r=0,i=0;r<e;){let m=c.indexOf(n[r]);a=r&3?(a<<6)+m:m,r++&3&&(t[i++]=255&a>>(-2*r&6))}return t};var y=async(n,e)=>new Uint8Array(await new Response(new Blob([n]).stream().pipeThrough(e)).arrayBuffer()),w=(n,e="gzip")=>y(n,new CompressionStream(e)),P=(n,e="gzip")=>y(n,new DecompressionStream(e));var{math:{clamp01:b,parseNum:p},utils:{formatValuePrec:S}}=$genart,l="__autostart",v="__width",x="__height",_="__dpr",R="__seed",u="platform",d=class{params;cache={};_prng;_screen;constructor(){this.params=new URLSearchParams(location.search),this._screen=this.screen,this.initPRNG(),$genart.on("genart:param-change",async e=>{let t=await this.serializeParam(e.param);this.params.set(e.paramID,t),parent.postMessage({type:"paramadapter:update",params:this.params.toString()},"*"),e.param.update==="reload"&&(console.log("reloading w/",this.params.toString()),location.search=this.params.toString())}),$genart.on("genart:state-change",({state:e})=>{e==="ready"&&this.params.get(l)!=="0"&&$genart.start()}),window.addEventListener("resize",()=>{let{width:e,height:t,dpr:a}=this._screen,r=this.screen;(e!==r.width||t!==r.height||a!==r.dpr)&&(this._screen=r,$genart.emit({type:"genart:resize",screen:r}))}),parent.postMessage({type:"paramadapter:update",params:this.params.toString()},"*")}get mode(){return this.params.get("__mode")||"play"}get screen(){return{width:p(this.params.get(v),window.innerWidth),height:p(this.params.get(x),window.innerHeight),dpr:p(this.params.get(_),window.devicePixelRatio||1)}}get prng(){return this._prng}augmentParams(e){return Object.assign(e,{[R]:$genart.params.range({group:u,order:0,name:"PRNG seed",desc:"Manually defined seed value",min:0,max:1e13,default:Number(BigInt(this._prng.seed)),update:"reload",widget:"precise"}),[v]:$genart.params.range({group:u,order:1,name:"Width",desc:"Canvas width",min:100,max:16384,default:this._screen.width,randomize:!1,update:"reload",widget:"precise"}),[x]:$genart.params.range({group:u,order:2,name:"Height",desc:"Canvas height",min:100,max:16384,default:this._screen.height,randomize:!1,update:"reload",widget:"precise"}),[_]:$genart.params.range({group:u,order:3,name:"DPR",desc:"Device pixel ratio",min:1,max:4,default:this._screen.dpr,randomize:!1,update:"reload",widget:"precise"}),[l]:$genart.params.toggle({group:u,order:4,name:"Autostart",desc:"If enabled, artwork will start playing automatically",default:this.params.get(l)!=="0",randomize:!1,update:"reload"})})}async updateParam(e,t){let a=this.params.get(e);if(!(a==null||this.cache[e]===a))switch(this.cache[e]=a,t.type){case"color":case"choice":case"text":case"time":case"weighted":return{value:a};case"date":case"datetime":return{value:new Date(Date.parse(a))};case"img":return{value:await P(f(a))};case"numlist":return{value:a.split(",").map(r=>p(r))};case"range":return{value:+a};case"ramp":{let[r,...i]=a.split(",");if(!r||i.length<4||i.length&1){$genart.paramError(e);return}let m={l:"linear",s:"smooth",e:"exp"}[r]||"linear",s=[];for(let o=0;o<i.length;o+=2)s.push([b(p(i[o])),b(p(i[o+1]))]);return s.sort((o,A)=>o[0]-A[0]),{update:{mode:m,stops:s.flat()}}}case"strlist":return{value:a.split(",")};case"toggle":return{value:a==="1"};case"xy":return{value:a.split(",").map(r=>+r)}}}async serializeParam(e){switch(e.type){case"color":return e.value.substring(1);case"date":return e.value.toISOString().substring(0,10);case"datetime":return e.value.toISOString();case"img":return h(await w(e.value));case"numlist":case"strlist":return e.value.join(",");case"ramp":{let t=e;return t.mode[0]+","+t.stops.flatMap(a=>a).join(",")}case"range":return S(e.step)(e.value);case"time":return e.value.join(":");case"toggle":return e.value?1:0;case"xy":return e.value.map(t=>t.toFixed(3)).join(",");default:return e.value}}capture(e){console.log("TODO handle capture...",e)}initPRNG(){let e=this.params.get(R),t=BigInt(e??Math.floor(Math.random()*1e13)),a=0xffffffffn,r=()=>i.rnd=g([Number(t>>96n&a)>>>0,Number(t>>64n&a)>>>0,Number(t>>32n&a)>>>0,Number(t&a)>>>0]),i={seed:"0x"+t.toString(16),reset:r};r(),this._prng=i}};$genart.setAdapter(new d);})();
