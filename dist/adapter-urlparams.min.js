"use strict";(()=>{var g=t=>{let e=Array.isArray(t)?t:new Uint8Array(t.buffer,t.byteOffset,t.byteLength);return btoa(String.fromCharCode(...e))},u=t=>new Uint8Array([...atob(t)].map(e=>e.charCodeAt(0)));var l=async(t,e)=>new Uint8Array(await new Response(new Blob([t]).stream().pipeThrough(e)).arrayBuffer()),h=(t,e="gzip")=>l(t,new CompressionStream(e)),f=(t,e="gzip")=>l(t,new DecompressionStream(e));var y=t=>{let e=new Uint32Array(4);return e.set(t),()=>{let r=(e[0]+e[1]>>>0)+e[3]>>>0;return e[3]=e[3]+1>>>0,e[0]=e[1]^e[1]>>>9,e[1]=e[2]+(e[2]<<3)>>>0,e[2]=(e[2]<<21|e[2]>>>11)+r>>>0,r/4294967296}};var{math:{clamp01:w,parseNum:o},utils:{formatValuePrec:P}}=$genart,c="__autostart",v="__width",b="__height",_="__dpr",A="__seed",m="platform",d=class{params;cache={};_prng;_screen;constructor(){this.params=new URLSearchParams(location.search),this._screen=this.screen,this.initPRNG(),$genart.on("genart:param-change",async e=>{let r=await this.serializeParam(e.param);this.params.set(e.paramID,r),parent.postMessage({type:"urlparamsadapter:set-params",params:this.params.toString()},"*"),e.param.update==="reload"&&(console.log("reloading w/",this.params.toString()),location.search=this.params.toString())}),$genart.on("genart:state-change",({state:e})=>{e==="ready"&&this.params.get(c)!=="0"&&$genart.start()}),window.addEventListener("resize",()=>{let{width:e,height:r,dpr:a}=this._screen,s=this.screen;(e!==s.width||r!==s.height||a!==s.dpr)&&(this._screen=s,$genart.emit({type:"genart:resize",screen:s}))}),parent.postMessage({type:"urlparamsadapter:set-params",params:this.params.toString()},"*")}get mode(){return this.params.get("__mode")||"play"}get screen(){return{width:o(this.params.get(v),window.innerWidth),height:o(this.params.get(b),window.innerHeight),dpr:o(this.params.get(_),window.devicePixelRatio||1)}}get prng(){return this._prng}augmentParams(e){return Object.assign(e,{[A]:$genart.params.range({group:m,order:0,name:"PRNG seed",desc:"Manually defined seed value",min:0,max:1e13,default:Number(BigInt(this._prng.seed)),update:"reload",widget:"precise"}),[v]:$genart.params.range({group:m,order:1,name:"Width",desc:"Canvas width",min:100,max:16384,default:this._screen.width,randomize:!1,update:"reload",widget:"precise"}),[b]:$genart.params.range({group:m,order:2,name:"Height",desc:"Canvas height",min:100,max:16384,default:this._screen.height,randomize:!1,update:"reload",widget:"precise"}),[_]:$genart.params.range({group:m,order:3,name:"DPR",desc:"Device pixel ratio",min:1,max:4,default:this._screen.dpr,randomize:!1,update:"reload",widget:"precise"}),[c]:$genart.params.toggle({group:m,order:4,name:"Autostart",desc:"If enabled, artwork will start playing automatically",default:this.params.get(c)!=="0",randomize:!1,update:"reload"})})}async updateParam(e,r){let a=this.params.get(e);if(!(a==null||this.cache[e]===a))switch(this.cache[e]=a,r.type){case"color":case"choice":case"text":case"time":case"weighted":return{value:a};case"date":case"datetime":return{value:new Date(Date.parse(a))};case"img":return{value:await f(u(a))};case"numlist":return{value:a.split(",").map(s=>o(s))};case"range":return{value:+a};case"ramp":{let[s,...n]=a.split(",");if(!s||n.length<4||n.length&1){$genart.paramError(e);return}let R={l:"linear",s:"smooth",e:"exp"}[s]||"linear",p=[];for(let i=0;i<n.length;i+=2)p.push([w(o(n[i])),w(o(n[i+1]))]);return p.sort((i,S)=>i[0]-S[0]),{update:{mode:R,stops:p.flat()}}}case"strlist":return{value:a.split(",")};case"toggle":return{value:a==="1"};case"vector":case"xy":return{value:a.split(",").map(s=>+s)}}}async serializeParam(e){switch(e.type){case"color":return e.value.substring(1);case"date":return e.value.toISOString().substring(0,10);case"datetime":return e.value.toISOString();case"img":return g(await h(e.value));case"numlist":case"strlist":return e.value.join(",");case"ramp":{let r=e;return r.mode[0]+","+r.stops.flat().map(a=>a.toFixed(3)).join(",")}case"range":return P(e.step)(e.value);case"time":return e.value.join(":");case"toggle":return e.value?1:0;case"vector":case"xy":{let r=e,a=Array.isArray(r.step)?r.step[0]:.001;return r.value.map(P(a)).join(",")}default:return e.value}}capture(e){console.log("TODO handle capture...",e)}initPRNG(){let e=this.params.get(A),r=BigInt(e??Math.floor(Math.random()*1e13)),a=0xffffffffn,s=()=>n.rnd=y([Number(r>>96n&a)>>>0,Number(r>>64n&a)>>>0,Number(r>>32n&a)>>>0,Number(r&a)>>>0]),n={seed:"0x"+r.toString(16),reset:s};s(),this._prng=n}};$genart.setAdapter(new d);})();
